"'TO Request Screen' As screen":
    OnVisible: |-
        =If(IsBlankOrError(RequestDates),ClearCollect(RequestDates, {
            StartDate: Today(),
            EndDate: Today(),
            Reason: "VCN",
            EntireDay: true,
            StartTime: "9:00", // 9-5, because why not
            EndTime: "17:00"
        }));
        
        If(Not(IsBlankOrError(Edit)),
            Clear(RequestDates);
            ClearCollect(EditDays, LookUp(TimeOffRequestDays, Request.Id = Edit.ID));
            UpdateContext({EditArchive: Edit, Edit: Blank()});
            ForAll(EditDays, Collect(RequestDates, {
                ID: ID,
                StartDate: StartDate,
                EndDate: EndDate,
                Reason: Reason.Value,
                StartTime: StartTime,
                EndTime: EndTime
            }));
        );

    "'TO Request Screen Main Container' As groupContainer.verticalAutoLayoutContainer":
        Height: =Parent.Height
        LayoutAlignItems: =LayoutAlignItems.Stretch
        LayoutDirection: =LayoutDirection.Vertical
        LayoutGap: =10
        LayoutMode: =LayoutMode.Auto
        LayoutOverflowY: =LayoutOverflow.Scroll
        PaddingBottom: =1
        Width: =Parent.Width
        ZIndex: =1

        "'TO Request Screen Header' As groupContainer.horizontalAutoLayoutContainer":
            Fill: =RGBA(39, 67, 125, 1)
            FillPortions: =0
            Height: =100
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutJustifyContent: =LayoutJustifyContent.Center
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            RadiusBottomLeft: =0
            RadiusBottomRight: =0
            RadiusTopLeft: =0
            RadiusTopRight: =0
            ZIndex: =1

            "'TO Request Screen Header Back' As icon.ArrowLeft":
                Color: =RGBA(255, 255, 255, 1)
                Icon: =Icon.ArrowLeft
                OnSelect: =Back();
                Width: =50
                ZIndex: =1

            "'TO Request Screen Header Text' As label":
                Align: =Align.Center
                Color: =RGBA(255, 255, 255, 1)
                FillPortions: =1
                Font: =Font.Lato
                Size: =20
                Text: ="Requests"
                ZIndex: =2

        "'TO Request Screen Dates Gallery' As gallery.galleryVertical":
            DelayItemLoading: =true
            FillPortions: =3
            Height: =Parent.Height
            Items: =RequestDates
            Layout: =Layout.Vertical
            LayoutMinHeight: =287
            LayoutMinWidth: =Parent.Width
            LoadingSpinner: =LoadingSpinner.Data
            TemplateSize: =150
            Width: =Parent.Width
            ZIndex: =2

            "'TO Request Screen Dates Gallery Columns' As groupContainer.horizontalAutoLayoutContainer":
                Height: =Parent.TemplateHeight
                LayoutAlignItems: =LayoutAlignItems.Stretch
                LayoutDirection: =If(App.Width > ScreenSize.Medium, LayoutDirection.Horizontal, LayoutDirection.Vertical)
                LayoutGap: =20
                LayoutJustifyContent: =LayoutJustifyContent.SpaceBetween
                LayoutMode: =LayoutMode.Auto
                Width: =Parent.TemplateWidth
                ZIndex: =1

                "'TO Request Screen Dates Date Range' As label":
                    FillPortions: =1
                    Font: =Font.Lato
                    LayoutMinWidth: =60
                    Size: =If('TO Request Screen'.Size=1,7,12)
                    Text: =ThisItem.StartDate & "-" & ThisItem.EndDate
                    Width: |
                        =
                        Parent.Width*.20
                    ZIndex: =1

                "'TO Request Screen Dates Time Range' As label":
                    FillPortions: =1
                    Font: =Font.Lato
                    LayoutMinWidth: =60
                    Size: =If('TO Request Screen'.Size=1,7,12)
                    Text: =ThisItem.StartTime & "-" & ThisItem.EndTime
                    Width: =Parent.Width*.20
                    ZIndex: =2

                "'TO Request Screen Dates Reason' As label":
                    FillPortions: =1
                    LayoutMinWidth: =40
                    Size: =If('TO Request Screen'.Size=1,7,12)
                    Text: |
                        =ThisItem.Reason
                    Width: =Parent.Width*.10
                    ZIndex: =3

                "'TO Request Screen Dates Edit Button' As button":
                    Fill: =RGBA(39, 67, 125, 1)
                    FillPortions: =2
                    Font: =Font.Lato
                    LayoutMinWidth: =50
                    OnSelect: |-
                        =Navigate('TO Request Date Screen', ScreenTransition.Cover, {Edit: ThisItem})
                    Size: =10
                    Text: ="Edit"
                    Width: =Parent.Width*.20
                    ZIndex: =5

                "'TO Request Screen Dates Delete Button' As button":
                    Fill: =RGBA(151, 0, 0, 1)
                    FillPortions: =1
                    Font: =Font.Lato
                    LayoutMinWidth: =60
                    OnSelect: =Remove(RequestDates, ThisItem)
                    Size: =10
                    Text: ="Delete"
                    Width: =Parent.Width*.20
                    ZIndex: =6

        "'TO Request Screen Comments Label' As label":
            Text: ="Additional Comments (Optional)"
            Visible: =false
            ZIndex: =3

        "'TO Request Screen Comments Input' As text":
            Default: =If(IsBlank(Edit), "", Edit.Comments)
            FillPortions: =1
            Font: =Font.Lato
            HintText: ="Enter comments here"
            LayoutMinHeight: =150
            Mode: =TextMode.MultiLine
            Size: =20
            Visible: =false
            ZIndex: =4

        testing As groupContainer.verticalAutoLayoutContainer:
            Height: =Parent.Height/4
            LayoutDirection: =LayoutDirection.Vertical
            LayoutMinHeight: =100
            LayoutMinWidth: ='TO Request Screen Main Container'.Width
            LayoutMode: =LayoutMode.Auto
            ZIndex: =5

            "'TO Request Screen Comments Label_1' As label":
                AlignInContainer: =AlignInContainer.Stretch
                AutoHeight: =true
                FillPortions: =1
                LineHeight: =1.3
                Text: ="Additional Comments (Optional)"
                ZIndex: =1

            "'TO Request Screen Comments Input_1' As text":
                AlignInContainer: =AlignInContainer.Stretch
                Default: =If(IsBlank(Edit), "", Edit.Comments)
                FillPortions: =1
                Font: =Font.Lato
                HintText: ="Enter comments here"
                LayoutMinHeight: =200
                Mode: =TextMode.MultiLine
                Size: =20
                ZIndex: =2

        "'TO Request Screen Buttons Container' As groupContainer.horizontalAutoLayoutContainer":
            FillPortions: =0
            Height: =100
            LayoutAlignItems: =LayoutAlignItems.Stretch
            LayoutGap: =50
            LayoutJustifyContent: =LayoutJustifyContent.Center
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            ZIndex: =6

            "'TO Request Screen Add Date Button' As button":
                Fill: =RGBA(39, 67, 125, 1)
                FillPortions: =1
                Font: =Font.Lato
                Height: =80
                OnSelect: =Navigate('TO Request Date Screen')
                Text: ="Add Date Range"
                ZIndex: =1

            "'TO Request Screen Submit Button' As button":
                FillPortions: =1
                Font: =Font.Lato
                Height: =80
                OnSelect: |-
                    =If(!IsBlank(Edit),
                        Trace("Cancel Previous TO Request");
                        Patch(TimeOffRequestDays, LookUp(TimeOffRequestDays, ID = Edit.ID), {
                            Status: { Value: "Cancelled" }
                        });
                    );
                    With({
                        Request: Patch(TimeOffRequests, Defaults(TimeOffRequests), {
                            Reason: 'TO Request Screen Comments Input'.Text,
                            Requester: UserRecord.ID,
                            Status: {Value: "Pending"},
                            Comments: ""
                        })
                    },
                        ForAll(RequestDates, With({Date: ThisRecord},
                                Patch(TimeOffRequestDays,
                                    If(IsBlankOrError(ID),
                                        Defaults(TimeOffRequestDays),
                                        LookUp(TimeOffRequestDays, ID = Date.ID)
                                    ),
                                    {
                                        Request: {Id: Request.ID, Value: Request.ID},
                                        StartDate: Date.StartDate,
                                        EndDate: Date.EndDate,
                                        EntireDay: Date.EntireDay,
                                        StartTime: Date.StartTime,
                                        EndTime: Date.EndTime,
                                        Reason: { Id: LookUp(RequestCodes, Title = Date.Reason).ID, Value: Date.Reason },
                                        AdditionalComments: Date.Comments,
                                        ITEquipment: Date.ITEquipment
                                    }
                                )
                            );
                        );
                    );
                    
                    Clear(RequestDates);
                    Reset('TO Request Screen Comments Input');
                    Navigate('Success Screen', ScreenTransition.CoverRight);
                Text: ="Submit Request"
                ZIndex: =2

